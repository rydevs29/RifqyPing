<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdgePulse - Pro Network Diagnostics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { neon: '#00f2fe', darkBg: '#050505', glassBg: '#111111', border: '#222' }
                }
            }
        }
    </script>
    <style>
        body { background-color: #050505; color: #ededed; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .glass { background: rgba(17, 17, 17, 0.7); backdrop-filter: blur(16px); border: 1px solid #222; box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); }
        .neon-glow { text-shadow: 0 0 15px rgba(0, 242, 254, 0.6); }
        .tab-content { display: none; opacity: 0; transform: translateY(10px); transition: all 0.4s ease; }
        .tab-content.active { display: block; opacity: 1; transform: translateY(0); }
        /* Scrollbar custom */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #00f2fe; }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row">

    <div class="md:hidden fixed top-0 w-full glass z-50 p-4 flex justify-between items-center">
        <button onclick="toggleSidebar()" class="text-neon text-2xl px-2"><i class="fa-solid fa-ellipsis-vertical"></i></button>
        <span class="font-black text-white tracking-widest uppercase">Edge<span class="text-neon">Pulse</span></span>
        <div class="w-8"></div>
    </div>

    <aside id="sidebar" class="fixed md:static h-full w-72 glass z-40 transform -translate-x-full md:translate-x-0 transition-transform duration-300 p-6 flex flex-col gap-6 pt-24 md:pt-6">
        <div class="hidden md:flex items-center gap-4 mb-4">
            <i class="fa-solid fa-ellipsis-vertical text-neon text-2xl cursor-pointer hover:scale-110 transition" onclick="toggleSidebar()"></i>
            <h1 class="text-2xl font-black tracking-tighter text-white uppercase">Edge<span class="text-neon">Pulse</span></h1>
        </div>

        <nav class="flex flex-col gap-2 flex-1">
            <button onclick="switchTab('dash')" class="nav-btn active flex items-center gap-3 p-4 rounded-xl bg-neon/10 text-neon font-bold border border-neon/20 transition">
                <i class="fa-solid fa-gauge-high w-5"></i> Network Health
            </button>
            <button onclick="switchTab('stability')" class="nav-btn flex items-center gap-3 p-4 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition">
                <i class="fa-solid fa-chart-line w-5"></i> Jitter & Packet Loss
            </button>
            <button onclick="switchTab('global')" class="nav-btn flex items-center gap-3 p-4 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition">
                <i class="fa-solid fa-earth-asia w-5"></i> Global Edge Nodes
            </button>
            <button onclick="switchTab('dot')" class="nav-btn flex items-center gap-3 p-4 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition">
                <i class="fa-solid fa-shield-halved w-5"></i> DNS over TLS Lab
            </button>
            <button onclick="switchTab('tools')" class="nav-btn flex items-center gap-3 p-4 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition">
                <i class="fa-solid fa-map-location-dot w-5"></i> IP Geospatial
            </button>
        </nav>
        
        <button onclick="generateReport()" class="bg-gray-800 hover:bg-gray-700 text-white p-3 rounded-xl text-sm font-bold transition flex items-center justify-center gap-2">
            <i class="fa-solid fa-copy"></i> Copy ISP Report
        </button>
    </aside>

    <div id="overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-30 hidden md:hidden"></div>

    <main class="flex-1 p-6 md:p-10 pt-24 md:pt-10 overflow-y-auto w-full">
        
        <div id="dash" class="tab-content active max-w-5xl mx-auto">
            <div class="flex justify-between items-end mb-8">
                <div>
                    <h2 class="text-4xl font-black text-white">System <span class="text-neon">Dashboard</span></h2>
                    <p class="text-gray-500 mt-1">Diagnosa otomatis rute Vercel Edge terdekat.</p>
                </div>
                <button onclick="runAutoTest()" class="hidden md:block bg-neon text-black font-bold px-8 py-3 rounded-xl hover:bg-cyan-300 transition shadow-[0_0_15px_rgba(0,242,254,0.4)]">
                    <i class="fa-solid fa-rotate-right"></i> Run Analysis
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass p-8 rounded-3xl md:col-span-2 flex flex-col items-center justify-center text-center relative overflow-hidden">
                    <div class="absolute top-4 left-6 text-xs text-gray-500 font-bold tracking-widest"><i class="fa-solid fa-satellite-dish"></i> CURRENT LATENCY</div>
                    <div id="main-ping" class="text-8xl md:text-9xl font-black neon-glow mt-4">--<span class="text-3xl">ms</span></div>
                    <div id="ping-status" class="mt-6 px-6 py-2 rounded-full bg-gray-900 border border-gray-700 text-gray-400 text-sm font-bold tracking-wide">SIAP DITES</div>
                </div>

                <div class="glass p-8 rounded-3xl flex flex-col justify-between">
                    <div>
                        <h3 class="text-lg font-bold border-b border-border pb-3 mb-4"><i class="fa-solid fa-route text-neon"></i> Routing Info</h3>
                        <ul class="space-y-4 text-sm">
                            <li class="flex justify-between"><span class="text-gray-500">Public IP</span> <strong id="geo-ip" class="text-white">...</strong></li>
                            <li class="flex justify-between"><span class="text-gray-500">ISP / Kota</span> <strong id="geo-city" class="text-white">...</strong></li>
                            <li class="flex justify-between"><span class="text-gray-500">Negara</span> <strong id="geo-country" class="text-white">...</strong></li>
                            <li class="flex justify-between"><span class="text-gray-500">Vercel Node</span> <strong id="geo-node" class="text-neon bg-neon/10 px-2 py-0.5 rounded font-mono">...</strong></li>
                        </ul>
                    </div>
                    <div id="diag-alert" class="mt-6 p-4 rounded-xl bg-red-900/30 border border-red-500/30 hidden">
                        <div class="text-red-400 font-bold text-sm mb-1"><i class="fa-solid fa-triangle-exclamation"></i> Routing Bocor!</div>
                        <div class="text-gray-400 text-xs">Ping kamu di atas 200ms. ISP kamu salah merutekan trafik ke luar Asia. Gunakan VPN atau lapor ISP.</div>
                    </div>
                </div>
            </div>
            <button onclick="runAutoTest()" class="md:hidden mt-6 w-full bg-neon text-black font-bold px-8 py-4 rounded-xl hover:bg-cyan-300 transition">
                JALANKAN TES SEKARANG
            </button>
        </div>

        <div id="stability" class="tab-content max-w-5xl mx-auto">
            <h2 class="text-3xl font-black mb-2">Jitter & <span class="text-neon">Packet Loss</span></h2>
            <p class="text-gray-500 mb-8">Menembakkan 20 paket secara beruntun untuk mengukur stabilitas koneksi.</p>

            <button onclick="runStabilityTest()" id="btn-stab" class="mb-6 bg-white text-black font-bold px-8 py-3 rounded-xl hover:bg-gray-200 transition">Mulai Tes Stabilitas</button>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass p-8 rounded-3xl text-center">
                    <div class="text-gray-500 text-sm font-bold mb-2 uppercase">Jitter (Fluktuasi)</div>
                    <div id="res-jitter" class="text-6xl font-black text-white">-- ms</div>
                    <p class="text-xs text-gray-500 mt-2">Semakin kecil semakin baik untuk Gaming/Zoom.</p>
                </div>
                <div class="glass p-8 rounded-3xl text-center">
                    <div class="text-gray-500 text-sm font-bold mb-2 uppercase">Packet Loss</div>
                    <div id="res-loss" class="text-6xl font-black text-white">-- %</div>
                    <p class="text-xs text-gray-500 mt-2">Jika > 0%, koneksi kamu sering putus-putus.</p>
                </div>
            </div>
            
            <div class="mt-6 glass p-4 rounded-2xl">
                <div class="flex justify-between text-xs text-gray-500 mb-2">
                    <span>Progres Pengiriman Paket</span>
                    <span id="stab-count">0 / 20</span>
                </div>
                <div class="w-full bg-gray-900 rounded-full h-2.5">
                    <div id="stab-bar" class="bg-neon h-2.5 rounded-full transition-all" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <div id="global" class="tab-content max-w-5xl mx-auto">
            <h2 class="text-3xl font-black mb-8">Global <span class="text-neon">Edge Nodes</span></h2>
            
            <div class="mb-4 text-neon font-bold border-b border-border pb-2"><i class="fa-solid fa-earth-asia"></i> Server Asia (Seharusnya < 100ms)</div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                <button onclick="pingRegion('sin1')" class="glass p-5 rounded-2xl text-left hover:border-neon transition group"><div class="text-xs text-gray-500">Singapore</div><div class="font-bold">sin1</div><div id="r-sin1" class="text-2xl font-black mt-2 text-gray-600">-- ms</div></button>
                <button onclick="pingRegion('hkg1')" class="glass p-5 rounded-2xl text-left hover:border-neon transition group"><div class="text-xs text-gray-500">Hong Kong</div><div class="font-bold">hkg1</div><div id="r-hkg1" class="text-2xl font-black mt-2 text-gray-600">-- ms</div></button>
                <button onclick="pingRegion('hnd1')" class="glass p-5 rounded-2xl text-left hover:border-neon transition group"><div class="text-xs text-gray-500">Tokyo, Japan</div><div class="font-bold">hnd1</div><div id="r-hnd1" class="text-2xl font-black mt-2 text-gray-600">-- ms</div></button>
            </div>

            <div class="mb-4 text-blue-400 font-bold border-b border-border pb-2"><i class="fa-solid fa-earth-americas"></i> Server Jauh (US, EU, AUS)</div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <button onclick="pingRegion('iad1')" class="glass p-5 rounded-2xl text-left hover:border-blue-400 transition group"><div class="text-xs text-gray-500">Washington, USA</div><div class="font-bold">iad1</div><div id="r-iad1" class="text-2xl font-black mt-2 text-gray-600">-- ms</div></button>
                <button onclick="pingRegion('fra1')" class="glass p-5 rounded-2xl text-left hover:border-blue-400 transition group"><div class="text-xs text-gray-500">Frankfurt, Germany</div><div class="font-bold">fra1</div><div id="r-fra1" class="text-2xl font-black mt-2 text-gray-600">-- ms</div></button>
                <button onclick="pingRegion('syd1')" class="glass p-5 rounded-2xl text-left hover:border-blue-400 transition group"><div class="text-xs text-gray-500">Sydney, Australia</div><div class="font-bold">syd1</div><div id="r-syd1" class="text-2xl font-black mt-2 text-gray-600">-- ms</div></button>
            </div>
        </div>

        <div id="dot" class="tab-content max-w-4xl mx-auto">
            <h2 class="text-3xl font-black mb-2">DNS over <span class="text-neon">TLS/HTTPS</span></h2>
            <p class="text-gray-500 mb-8">Tes waktu respon resolver DNS. Berguna jika browsing lemot tapi ping bagus.</p>

            <div class="glass p-6 rounded-3xl mb-6">
                <label class="text-xs text-gray-400 font-bold mb-3 block">RESOLVER DOMAIN / IP</label>
                <div class="flex flex-col sm:flex-row gap-3">
                    <input type="text" id="dot-in" placeholder="Contoh: dns.adguard-dns.com atau 1.1.1.1" class="flex-1 bg-black/50 border border-gray-700 rounded-xl px-5 py-4 text-white outline-none focus:border-neon transition">
                    <button onclick="testDoT()" class="bg-neon text-black font-bold px-8 py-4 rounded-xl hover:bg-white transition whitespace-nowrap"><i class="fa-solid fa-bolt"></i> TES DNS</button>
                </div>
                <div class="flex flex-wrap gap-2 mt-4">
                    <span class="text-xs text-gray-600 mt-1">Preset:</span>
                    <button onclick="document.getElementById('dot-in').value='1.1.1.1'; testDoT()" class="text-xs bg-gray-800 px-3 py-1 rounded-full text-gray-300 hover:text-white">Cloudflare</button>
                    <button onclick="document.getElementById('dot-in').value='dns.google'; testDoT()" class="text-xs bg-gray-800 px-3 py-1 rounded-full text-gray-300 hover:text-white">Google</button>
                    <button onclick="document.getElementById('dot-in').value='dns.adguard-dns.com'; testDoT()" class="text-xs bg-gray-800 px-3 py-1 rounded-full text-gray-300 hover:text-white">AdGuard</button>
                </div>
            </div>

            <div class="glass p-8 rounded-3xl flex justify-between items-center">
                <div>
                    <h3 class="text-gray-400 font-bold">Waktu Resolusi DNS</h3>
                    <p id="dot-msg" class="text-sm text-gray-600 mt-1">Menunggu tes...</p>
                </div>
                <div id="dot-res" class="text-5xl font-black text-gray-700">-- ms</div>
            </div>
        </div>

        <div id="tools" class="tab-content max-w-4xl mx-auto">
            <h2 class="text-3xl font-black mb-2">IP <span class="text-neon">Geospatial Info</span></h2>
            <p class="text-gray-500 mb-8">Lacak lokasi, ASN, dan ISP dari sebuah IP atau Domain secara akurat.</p>

            <div class="glass p-6 rounded-3xl mb-6">
                <div class="flex flex-col sm:flex-row gap-3">
                    <input type="text" id="ip-in" placeholder="Masukkan IP address..." class="flex-1 bg-black/50 border border-gray-700 rounded-xl px-5 py-4 text-white outline-none focus:border-neon transition">
                    <button onclick="lookupIP()" id="btn-lookup" class="bg-white text-black font-bold px-8 py-4 rounded-xl hover:bg-gray-200 transition">LOOKUP</button>
                </div>
            </div>

            <div id="lookup-res" class="glass p-8 rounded-3xl hidden">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div>
                        <div class="text-xs text-gray-500 mb-1">ORGANIZATION / ISP</div>
                        <div id="res-isp" class="text-lg font-bold text-white">...</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-500 mb-1">LOKASI (KOTA, NEGARA)</div>
                        <div id="res-loc" class="text-lg font-bold text-neon">...</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-500 mb-1">LATITUDE / LONGITUDE</div>
                        <div id="res-latlon" class="text-lg font-bold text-white font-mono">...</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-500 mb-1">ASN / TIMEZONE</div>
                        <div id="res-asn" class="text-lg font-bold text-white">...</div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- UI Logic ---
        function toggleSidebar() { 
            document.getElementById('sidebar').classList.toggle('-translate-x-full'); 
            document.getElementById('overlay').classList.toggle('hidden');
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.className = 'nav-btn flex items-center gap-3 p-4 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition';
            });
            event.currentTarget.className = 'nav-btn active flex items-center gap-3 p-4 rounded-xl bg-neon/10 text-neon font-bold border border-neon/20 transition';
            
            if(window.innerWidth < 768) toggleSidebar();
        }

        // --- Core Fetch Logic dengan Bypass Cache ---
        async function fetchPing(url) {
            const start = performance.now();
            try {
                // Tambahkan random ID agar ISP tidak bisa me-load cache
                const bypassUrl = url.includes('?') ? `${url}&_t=${Date.now()}&_r=${Math.random()}` : `${url}?_t=${Date.now()}&_r=${Math.random()}`;
                const res = await fetch(bypassUrl, { cache: 'no-store', method: 'GET' });
                if (!res.ok) throw new Error();
                const end = performance.now();
                return Math.round(end - start);
            } catch (e) { return 'ERR'; }
        }

        function updatePingUI(ms, elId, statusId = null) {
            const el = document.getElementById(elId);
            if(ms === 'ERR') {
                el.innerHTML = '<span class="text-red-500">GAGAL</span>';
                if(statusId) {
                    document.getElementById(statusId).innerText = "KONEKSI TERPUTUS";
                    document.getElementById(statusId).className = "mt-6 px-6 py-2 rounded-full bg-red-900 border border-red-500 text-red-200 text-sm font-bold";
                }
                return;
            }

            el.innerHTML = `${ms}<span class="text-3xl md:text-5xl text-gray-500">ms</span>`;
            
            if(ms < 50) {
                el.className = "text-8xl md:text-9xl font-black text-neon neon-glow mt-4";
                if(statusId) setStatus(statusId, "EXCELLENT (GAMING READY)", "bg-green-900 border-green-500 text-green-300");
            } else if(ms < 150) {
                el.className = "text-8xl md:text-9xl font-black text-yellow-400 mt-4";
                if(statusId) setStatus(statusId, "GOOD (NORMAL)", "bg-yellow-900 border-yellow-500 text-yellow-300");
            } else {
                el.className = "text-8xl md:text-9xl font-black text-red-500 mt-4";
                if(statusId) setStatus(statusId, "HIGH LATENCY (POOR)", "bg-red-900 border-red-500 text-red-300");
            }
        }

        function setStatus(id, text, classes) {
            const el = document.getElementById(id);
            el.innerText = text;
            el.className = `mt-6 px-6 py-2 rounded-full border text-sm font-bold tracking-wide ${classes}`;
        }

        // --- Fitur 1: Dashboard Auto Test ---
        let reportData = {}; // Menyimpan data untuk generate report
        
        async function runAutoTest() {
            document.getElementById('main-ping').innerHTML = '<i class="fa-solid fa-circle-notch fa-spin text-gray-600 text-6xl"></i>';
            document.getElementById('ping-status').innerText = "DIAGNOSING ROUTE...";
            document.getElementById('diag-alert').style.display = 'none';

            // 1. Get Geo Info
            try {
                const geo = await fetch(`/api/geo?_t=${Date.now()}`).then(r => r.json());
                document.getElementById('geo-ip').innerText = geo.ip;
                document.getElementById('geo-city').innerText = geo.city;
                document.getElementById('geo-country').innerText = geo.country;
                document.getElementById('geo-node').innerText = geo.node;
                reportData.geo = geo;
            } catch(e) { console.error(e); }

            // 2. Do Ping Test
            const latency = await fetchPing('/api/ping');
            updatePingUI(latency, 'main-ping', 'ping-status');
            reportData.latency = latency;

            // Smart Diagnosis untuk 300ms+
            if(latency !== 'ERR' && latency > 200) {
                document.getElementById('diag-alert').style.display = 'block';
            }
        }

        // --- Fitur 2: Jitter & Packet Loss Test ---
        async function runStabilityTest() {
            document.getElementById('btn-stab').innerText = "Testing... Harap Tunggu";
            document.getElementById('btn-stab').disabled = true;
            
            let pings = [];
            let lost = 0;
            const totalPackets = 20;

            for(let i=1; i<=totalPackets; i++) {
                const lat = await fetchPing('/api/ping');
                if(lat === 'ERR' || lat > 2000) lost++;
                else pings.push(lat);

                // Update UI Progress
                document.getElementById('stab-count').innerText = `${i} / ${totalPackets}`;
                document.getElementById('stab-bar').style.width = `${(i/totalPackets)*100}%`;
                
                await new Promise(r => setTimeout(r, 150)); // Jeda antar paket
            }

            // Hitung Jitter (Selisih rata-rata)
            let jitter = 0;
            if(pings.length > 1) {
                let diffs = [];
                for(let i=1; i<pings.length; i++) {
                    diffs.push(Math.abs(pings[i] - pings[i-1]));
                }
                jitter = Math.round(diffs.reduce((a,b)=>a+b, 0) / diffs.length);
            }
            
            const lossPercent = Math.round((lost / totalPackets) * 100);

            // Tampilkan Hasil
            const jEl = document.getElementById('res-jitter');
            jEl.innerText = pings.length > 0 ? `${jitter} ms` : 'ERR';
            jEl.className = jitter > 30 ? "text-6xl font-black text-red-500" : "text-6xl font-black text-neon";

            const lEl = document.getElementById('res-loss');
            lEl.innerText = `${lossPercent} %`;
            lEl.className = lossPercent > 0 ? "text-6xl font-black text-red-500" : "text-6xl font-black text-neon";

            document.getElementById('btn-stab').innerText = "Tes Ulang Stabilitas";
            document.getElementById('btn-stab').disabled = false;
            
            reportData.jitter = jitter;
            reportData.loss = lossPercent;
        }

        // --- Fitur 3: Global Servers ---
        async function pingRegion(reg) {
            const el = document.getElementById(`r-${reg}`);
            el.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin text-gray-600"></i>';
            const latency = await fetchPing(`/api/ping?region=${reg}`);
            el.innerText = latency === 'ERR' ? 'GAGAL' : `${latency} ms`;
            el.className = latency === 'ERR' ? "text-2xl font-black mt-2 text-red-500" : "text-2xl font-black mt-2 text-neon";
        }

        // --- Fitur 4: DoT Test ---
        async function testDoT() {
            const domain = document.getElementById('dot-in').value || 'dns.google';
            const resEl = document.getElementById('dot-res');
            resEl.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin text-gray-600"></i>';
            document.getElementById('dot-msg').innerText = `Menghubungi ${domain}...`;

            const latency = await fetchPing(`/api/dot?server=${encodeURIComponent(domain)}`);
            
            if(latency === 'ERR') {
                resEl.innerHTML = '<span class="text-red-500">GAGAL</span>';
                document.getElementById('dot-msg').innerText = "Koneksi ke resolver ditolak / error.";
            } else {
                resEl.innerText = `${latency} ms`;
                resEl.className = "text-5xl font-black text-neon";
                document.getElementById('dot-msg').innerText = "Handshake DNS Berhasil.";
            }
        }

        // --- Fitur 5: IP Tools Backend Based ---
        async function lookupIP() {
            const ip = document.getElementById('ip-in').value;
            if(!ip) return alert("Masukkan IP!");
            
            document.getElementById('btn-lookup').innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
            try {
                // Fetch melalui backend Vercel kita untuk hindari CORS browser
                const res = await fetch(`/api/lookup?ip=${encodeURIComponent(ip)}`);
                const data = await res.json();

                document.getElementById('lookup-res').classList.remove('hidden');
                document.getElementById('res-isp').innerText = data.org || "Unknown ISP";
                document.getElementById('res-loc').innerText = `${data.city || '?'}, ${data.country_name || '?'}`;
                document.getElementById('res-latlon').innerText = `${data.latitude || 0}, ${data.longitude || 0}`;
                document.getElementById('res-asn').innerText = `${data.asn || '-'} / ${data.timezone || '-'}`;
            } catch(e) {
                alert("Gagal melacak IP. Pastikan format benar.");
            }
            document.getElementById('btn-lookup').innerText = 'LOOKUP';
        }

        // --- Fitur 6: Copy Report ---
        function generateReport() {
            if(!reportData.latency) {
                alert("Jalankan 'Network Health' (Dashboard) terlebih dahulu!");
                return switchTab('dash');
            }
            const text = `=== EDGEPULSE DIAGNOSTIC REPORT ===\nDate: ${new Date().toLocaleString()}\nIP: ${reportData.geo?.ip}\nISP/City: ${reportData.geo?.city}, ${reportData.geo?.country}\nConnected Edge Node: ${reportData.geo?.node}\n--- \nLatency to Node: ${reportData.latency}ms\nJitter: ${reportData.jitter !== undefined ? reportData.jitter+'ms' : 'Not Tested'}\nPacket Loss: ${reportData.loss !== undefined ? reportData.loss+'%' : 'Not Tested'}\n\n*Jika Latency > 100ms padahal node di Asia, kemungkinan ISP mengalami Routing Loop ke luar negeri.*`;
            
            navigator.clipboard.writeText(text);
            alert("Laporan berhasil di-copy! Silakan paste (Ctrl+V) ke WhatsApp CS ISP Anda.");
        }

        window.onload = runAutoTest;
    </script>
</body>
</html>
